.layout-inner
  .account
    -#Remove me later
    %div{style: 'padding-top: 20px;'}

    = link_to 'Link Card', '#', data: { 'reveal-id' => 'card-add-modal' }

    #social-link-widget


    .left-column
      .flag
        %h2.white SETTINGS
      .content
        %h4 Account Status

      %hr
      .content{data: {'account-edit-form' => true}}
        %h4 Email
        %h3.bold{data: {'display-value' => 'email'}}= current_user.email
        %a{data: {'toggleable-selector' => '.change'}} Change
        = form_tag account_path, class: 'change', method: 'put' do
          .error-messages
          .field
            %h2 Enter your new email address:
            = text_field_tag :email, '', placeholder: 'New Email Address', class: 'form-field input'
          .field
            %h2 Enter your password:
            = password_field_tag :password, '', class: 'form-field input', placeholder: 'Password'
          .cancel-btn
            = link_to 'Cancel', '#', class: 'button secondary-action', data: {cancel: true}
          .submit-btn
            %button.button.primary-action Change Your Email
      %hr
      .content
        %h4 Your Bank
        - if @user_has_account
          %h3.bold= @bank_account.bank_name
          = link_to 'Change', '#', data: {'reveal-id' => 'card-change-modal'}
      %hr
      .content
        %h4 Your Card
        - if @user_has_account
          %h3.bold= @bank_account.account_name
          %a Change

    %h1.cyan You have #{current_virtual_currency.amount_in_currency(current_user.current_balance)} #{current_virtual_currency.currency_name}.

    %p Lifetime balance: #{current_virtual_currency.amount_in_currency(current_user.lifetime_balance)} #{current_virtual_currency.currency_name}

    = render partial: 'accounts/recent_activity'

    - if current_user.can_redeem?
      = link_to 'Redeem', rewards_path

    #card-add-modal.reveal-modal.cf-modal
      %iframe{src: @card_link_url, style: 'height: 1000px; width: 100%;'}

    #card-change-modal.reveal-modal.cf-modal
      %iframe{src: @card_change_url, style: 'height: 1000px; width: 100%;'}

:javascript
  $(function() {
    Plink.conditionalCallback(
      window.location.search.match(/link_card=true/),
      function () {
      $('[data-reveal-id="card-add-modal"]').click();
      }
    )
  });


:plain
  <script type="text/handlebars-template" id="account-error-template">
    <img alt="Your account is inactive" class="status-img" src="/assets/icon_alert_pink.png">
    <p>{{instructions}}</p>
    <ul>
      {{#each errors}}
        <li class="font error">{{this}}</li>
      {{/each}}
    </ul>
  </script>